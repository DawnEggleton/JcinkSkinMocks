<!DOCTYPE html>
<html>
    <head>
        <title>Site Name</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--Styles-->
        <link rel="stylesheet" href="../css/styles.css" />

        <!--Fonts-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"> 
        

        <!--Icons-->
		<link href="https://dawneggleton.github.io/css/all.css" rel="stylesheet" />
		<link href="https://files.jcink.net/uploads/totl/saturnicons.css" rel="stylesheet" />
		<link href="https://files.jcink.net/uploads/totl/honeybee.css" rel="stylesheet" />
		<link href="https://files.jcink.net/uploads/totl/cappucicons.css" rel="stylesheet" />

        <!--Script Libraries-->
		<script type='text/javascript' src='https://files.jcink.net/html/jquery-1.7.2.min.js'></script>
		<script type='text/javascript' src='https://files.jcink.net/html/jquery.cookie-1.3.1.js'></script> 
		<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
        <script src="../js/clipboard.js"></script>

        <!--Settings-->
        <script type='text/javascript' src='../js/settings.js'></script>
        <link rel="stylesheet" href="../css/settings.css" />
    </head>
    <body id="Members" class="dark g-4">
        
        <!--Header-->
        <header></header>

        <!--Navigation-->
        <nav></nav>

        <!--Member Controls-->
        <div class="controls memOnly desktopOnly"></div>

        <!--Guest Controls-->
        <div class="controls guestOnly desktopOnly"></div>

        <!--Main Body-->
        <main>
            <a name="top"></a>
            <section class="ml">
                <div class="ml--top">
                    <div class="ml--top-left">
                        <h2>All Accounts</h2>
                    </div>
                    <div class="ml--top-right">
                        <!-- onkeyup="filterFunction('.memberlist-namesearch', '.mem--top a', 'name')" -->
                        <input id="quicksearch" class="forminput memberlist-namesearch" type="text" size="25" name="name" value="" placeholder="Filter by name...">
                        <button onClick="toggleFilters()" class="toggle-filter">
                            <i class="fas fa-plus"></i>
                            <i class="fas fa-minus"></i>
                            Filter
                        </button>
                        <button onClick="toggleSort()" class="toggle-sort">
                            <i class="fas fa-plus"></i>
                            <i class="fas fa-minus"></i>
                            Sort
                        </button>
                    </div>
                </div>
                <div class="ml--filters">
                    <div class="ml--filters-inner scroll">
                        <div class="ml--filtergroup ml-memberlist" data-filter-group="member">
                            <h2><span>Alias</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all members</label>          
                                <label><input type="checkbox" value=".ana">ana</label>
                                <label><input type="checkbox" value=".dashin">dashin</label>
                                <label><input type="checkbox" value=".jules">jules</label>
                                <label><input type="checkbox" value=".julia">julia</label>
                                <label><input type="checkbox" value=".kyo">kyo</label>
                                <label><input type="checkbox" value=".lauren">lauren</label>
                                <label><input type="checkbox" value=".lux">lux</label>
                                <label><input type="checkbox" value=".meriel">meriel</label>
                                <label><input type="checkbox" value=".morgan/high lady">morgan/high lady</label>
                                <label><input type="checkbox" value=".quinn">quinn</label>
                                <label><input type="checkbox" value=".shado">shado</label>
                                <label><input type="checkbox" value=".sol">sol</label>
                            </div>
                        </div>

                        <div class="ml--filtergroup" data-filter-group="group">
                            <h2><span>Group</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all groups</label>
                                <label><input type="checkbox" value=".g-4">staff</label>
                                <label><input type="checkbox" value=".g-6">writers</label>
                                <label><input type="checkbox" value=".active">active characters</label>
                                <label><input type="checkbox" value=".g-3">unsorted</label>
                                <label class="staffOnly"><input type="checkbox" value=".g-8">inactive</label>
                                <label><input type="checkbox" value=".g-7">hiatus</label>
                            </div>
                        </div>
                        
                        <div class="ml--filtergroup" data-filter-group="district">
                            <h2><span>District</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all locations</label>
                                <label><input type="checkbox" value=".g-12">central davenport</label>
                                <label><input type="checkbox" value=".g-10">coastline</label>
                                <label><input type="checkbox" value=".g-11">old town</label>
                                <label><input type="checkbox" value=".g-13">outskirts</label>
                                <label><input type="checkbox" value=".g-9">river's edge</label>
                            </div>
                        </div>
                        
                        <div class="ml--filtergroup" data-filter-group="age">
                            <h2><span>Age</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all ages</label>
                                <label><input type="checkbox" value=".20s">18 - 29</label>
                                <label><input type="checkbox" value=".30s">30 - 39</label>
                                <label><input type="checkbox" value=".40s">40 - 49</label>
                                <label><input type="checkbox" value=".50">50+</label>
                                <label><input type="checkbox" value=".immortal">Immortal</label>
                            </div>
                        </div>
                        
                        <div class="ml--filtergroup" data-filter-group="group">
                            <h2><span>Relationship</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all types</label>
                                <label><input type="checkbox" value=".single">single</label>
                                <label><input type="checkbox" value=".dating">dating</label>
                                <label><input type="checkbox" value=".engaged">engaged</label>
                                <label><input type="checkbox" value=".married">married</label>
                                <label><input type="checkbox" value=".separated">separated</label>
                                <label><input type="checkbox" value=".divorced">divorced</label>
                                <label><input type="checkbox" value=".widowed">widowed</label>
                                <label><input type="checkbox" value=".itscomplicated">it's complicated</label>
                            </div>
                        </div>
                        
                        <div class="ml--filtergroup" data-filter-group="group">
                            <h2><span>Meta?</span></h2>
                            <div class="scroll">
                                <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all</label>
                                <label><input type="checkbox" value=".meta">yes</label>
                                <label><input type="checkbox" value=".human">no</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ml--sort">
                    <div class="ml--sort-inner">
                        <h2><span>Sort By</span></h2>
                        <button type="button" class="members--sort" data-sort="name">Name (A -> Z)</button>
                        <button type="button" class="members--sort" data-sort="nameDesc">Name (Z -> A)</button>
                        <button type="button" class="members--sort" data-sort="age">Age (Asc)</button>
                        <button type="button" class="members--sort" data-sort="face">Face (A -> Z)</button>
                        <!--<a class="members--sort" href="?act=Members&name=&sort_key=posts&sort_order=desc&max_results=1000">Post Count</a>
                        <a class="members--sort" href="?act=Members&name=&sort_key=last_post&sort_order=desc&max_results=1000">Last Post</a>
                        <a class="members--sort" href="?act=Members&name=&sort_key=joined&sort_order=desc&max_results=1000">Join Date</a>-->
                    </div>
                </div>
                <div class="ml--members">
                    <form action='index.php' method='get'>
                        <input type='hidden' name='act' value='Members' />
                        
                        <div id="ml--rows"><div class="grid-sizer"></div></div>
                    </form>
                </div>
                <script>    
                    let accounts = [], members = [];
                    let $container = $('#ml--rows');
                    var filters = {};
                    let charAge = `0`, ageClass = ``;

                    function sortList(el, direction) {
                        let sort = el.getAttribute('data-sort');
                        accounts.sort((a, b) => {
                            let aSort = a[sort];
                            let bSort = b[sort];
                            if(a['type'] != 'Member' && b['type'] != 'Member') {
                                if (aSort === bSort) {
                                    return 0;
                                }
                                else if (aSort === `` || !aSort) {
                                    return 1;
                                }
                                else if (bSort === `` || !bSort) {
                                    return -1;
                                }
                                else if (direction === `asc` && aSort !== `` && bSort !== ``) {
                                    return aSort < bSort ? -1 : 1;
                                }
                                else if (direction === `desc` && aSort !== `` && bSort !== ``) {
                                    return aSort < bSort ? 1 : -1;
                                }
                            } else {
                                if (a['type'] == 'Member') {
                                    return 1;
                                } else if (b['type'] == 'Member') {
                                    return -1;
                                } else {
                                    return 0;
                                }
                            }
                        });
                        populatePage(accounts);
                        $container.isotope('reloadItems').isotope();
                    }
                    
                    function populatePage(array) {
                        let html = ``;
                        let members = [];
                        let membersClean = [];
                        for (let i = 0; i < array.length; i++) {
                            //Make Member Array
                            let member = {raw: array[i].rawAlias, clean: array[i].alias};
                            if(jQuery.inArray(member.clean, membersClean) == -1 && member.clean != '') {
                                membersClean.push(member.clean);
                                members.push(member);
                            }
                            switch(array[i].groupID) {
                                //member only
                                case 4:
                                case 6:
                                    html += `<div class="ml--member member onLoad grid-item g-${array[i].groupID} ${array[i].alias}">
                                        <div class="mem">
                                            <div class="mem--top">
                                                <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                <a href="?showuser=${array[i].id}">${array[i].name}</a>
                                                <span>${array[i].memPronouns}</span>
                                                <span>${array[i].memAge} years</span>
                                                <span>${array[i].groupName}</span>
                                            </div>
                                            <div class="mem--playedBy">
                                                Posts ${array[i].frequency}
                                            </div>
                                            <div class="mem--overview">
                                                <div class="scroll">${array[i].name} will not write ${array[i].limits}.</div>
                                            </div>
                                        </div>
                                    </div>`;
                                    break;
                                //depends on type
                                case 1:
                                case 5:
                                case 7:
                                case 8:
                                    if(array[i].type == `member`) {
                                        //member
                                        html += `<div class="ml--member member grid-item g-${array[i].groupID} ${array[i].alias}">
                                            <div class="mem">
                                                <div class="mem--top">
                                                    <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                    <a href="?showuser=${array[i].id}">${array[i].name}</a>
                                                    <span>${array[i].memPronouns}</span>
                                                    <span>${array[i].memAge} years</span>
                                                    <span>${array[i].groupName}</span>
                                                </div>
                                                <div class="mem--playedBy">
                                                    Posts ${array[i].frequency}
                                                </div>
                                                <div class="mem--overview">
                                                    <div class="scroll">${array[i].name} will not write ${array[i].limits}.</div>
                                                </div>
                                            </div>
                                        </div>`;
                                    } else {
                                        //character
                                        html += `<div class="ml--member character grid-item g-${array[i].groupID} ${array[i].ageClass} ${array[i].relStatus} ${array[i].species} ${array[i].alias}">
                                            <div class="mem">
                                                <div class="mem--top">
                                                    <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                    <a href="?showuser=${array[i].id}" class="name">${array[i].name}</a>
                                                    <span class="fullWidth face">${array[i].face}</span>
                                                    <span>${array[i].pronouns}</span>
                                                    <span><span class="age">${array[i].age}</span> years</span>
                                                    <span>${array[i].groupName}</span>
                                                </div>
                                                <div class="mem--playedBy">
                                                    Played by ${array[i].rawAlias}
                                                </div>
                                                <div class="mem--overview">
                                                    <div class="scroll">${array[i].overview}</div>
                                                </div>
                                            </div>
                                        </div>`;
                                    }
                                    break;
                                //unsorted
                                case 3:
                                    if(array[i].type == `member`) {
                                        //member
                                        html += `<div class="ml--member member onLoad grid-item g-${array[i].groupID} ${array[i].alias}">
                                            <div class="mem">
                                                <div class="mem--top">
                                                    <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                    <a href="?showuser=${array[i].id}">${array[i].name}</a>
                                                    <span>${array[i].memPronouns}</span>
                                                    <span>${array[i].memAge} years</span>
                                                    <span>${array[i].groupName}</span>
                                                </div>
                                                <div class="mem--playedBy">
                                                    Posts ${array[i].frequency}
                                                </div>
                                                <div class="mem--overview">
                                                    <div class="scroll">${array[i].name} will not write ${array[i].limits}.</div>
                                                </div>
                                            </div>
                                        </div>`;
                                    } else {
                                        //character
                                        html += `<div class="ml--member character onLoad grid-item g-${array[i].groupID} ${array[i].ageClass} ${array[i].relStatus} ${array[i].species} ${array[i].alias}">
                                            <div class="mem">
                                                <div class="mem--top">
                                                <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                <a href="?showuser=${array[i].id}" class="name">${array[i].name}</a>
                                                <span class="fullWidth face">${array[i].face}</span>
                                                <span>${array[i].pronouns}</span>
                                                <span><span class="age">${array[i].age}</span> years</span>
                                                <span>${array[i].groupName}</span>
                                                </div>
                                                <div class="mem--playedBy">
                                                    Played by ${array[i].rawAlias}
                                                </div>
                                                <div class="mem--overview">
                                                    <div class="scroll">${array[i].overview}</div>
                                                </div>
                                            </div>
                                        </div>`;
                                    }
                                    break;
                                //character only
                                default: 
                                    html += `<div class="ml--member character active onLoad grid-item g-${array[i].groupID} ${array[i].ageClass} ${array[i].relStatus} ${array[i].species} ${array[i].alias}">
                                        <div class="mem">
                                            <div class="mem--top">
                                                <img src="${array[i].image}" style="object-position: ${array[i].imagePos}" />
                                                <a href="?showuser=${array[i].id}" class="name">${array[i].name}</a>
                                                <span class="fullWidth face">${array[i].face}</span>
                                                <span>${array[i].pronouns}</span>
                                                <span><span class="age">${array[i].age}</span> years</span>
                                                <span>${array[i].groupName}</span>
                                            </div>
                                            <div class="mem--playedBy">
                                                Played by ${array[i].rawAlias}
                                            </div>
                                            <div class="mem--overview">
                                                <div class="scroll">${array[i].overview}</div>
                                            </div>
                                        </div>
                                    </div>`;
                                    break;
                            }
                        }
                        document.querySelector('#ml--rows').innerHTML = html;

                        //sort member array
                        members.sort();

                        //Append Array
                        members.forEach(member => {
                        document.querySelector('.ml-memberlist .scroll').insertAdjacentHTML('beforeend', `<label><input type="checkbox" value=".${member.clean}"/>${member.raw}</label>`);
                        });
                    }

                    function setCustomFilter() {
                        //get search value
                        qsRegex = document.querySelector('#quicksearch').value;
                        
                        //add show class to all items to reset
                        elements.forEach(el => el.classList.add('show'));
                        
                        //filter by nothing
                        let searchFilter = '';
                        
                        //check each item
                        elements.forEach(el => {
                            let name = el.querySelector('.mem--top a').textContent;
                            if(!name.toLowerCase().includes(qsRegex)) {
                                el.classList.remove('show');
                                searchFilter = '.show';
                            }
                        });
                    
                        let filterGroups = document.querySelectorAll('.ml--filtergroup');
                        let groups = [];
                        let checkFilters;
                        filterGroups.forEach(group => {
                            let filters = [];
                            group.querySelectorAll('label.is-checked input').forEach(filter => {
                                if(filter.value) {
                                    filters.push(filter.value);
                                }
                            });
                            groups.push({group: group.dataset.filterGroup, selected: filters});
                        });
                    
                        let filterCount = 0;
                        let comboFilters = [];
                        groups.forEach(group => {
                            // skip to next filter group if it doesn't have any values
                            if ( group.selected.length > 0 ) {
                                if ( filterCount === 0 ) {
                                    // copy groups to comboFilters
                                    comboFilters = group.selected;
                                } else {
                                    var filterSelectors = [];
                                    var groupCombo = comboFilters;
                                    // merge filter Groups
                                    for (var k = 0; k < group.selected.length; k++) {
                                        for (var j = 0; j < groupCombo.length; j++) {
                                            //accommodate weirdness with object vs not
                                            if(groupCombo[j].selected) {
                                                if(groupCombo[j].selected != group.selected[k]) {
                                                    filterSelectors.push( groupCombo[j].selected + group.selected[k] );
                                                }
                                            } else if (!groupCombo[j].selected && group.selected[k]) {
                                                if(groupCombo[j] != group.selected[k]) {
                                                    filterSelectors.push( groupCombo[j] + group.selected[k] );
                                                }
                                            }
                                        }
                                    }
                                    // apply filter selectors to combo filters for next group
                                    comboFilters = filterSelectors;
                                }
                                filterCount++;
                            }
                        });
                        
                        //set filter to blank
                        let filter = [];
                        //check if it's only search
                        if(qsRegex.length > 0 && comboFilters.length === 0) {
                            filter = ['.show'];
                        }
                        //check if it's only checkboxes
                        else if(qsRegex.length === 0 && comboFilters.length > 0) {
                            let combos = comboFilters.join(',').split(',');
                            filter = [...combos];
                        }
                        //check if it's both
                        else if (qsRegex.length > 0 && comboFilters.length > 0) {
                            let dualFilters = comboFilters.map(filter => filter + '.show');
                            filter = [...dualFilters];
                        }
                    
                        //join array into string
                        filter = filter.join(', ');
                        
                        //render isotope
                        $container.isotope({
                            filter: filter
                        });
                    }
                
                    // debounce so filtering doesn't happen every millisecond
                    function debounce(fn, threshold) {
                        var timeout;
                        return function debounced() {
                            if (timeout) {
                            clearTimeout(timeout);
                            }
                    
                            function delayed() {
                            fn();
                            timeout = null;
                            }
                            setTimeout(delayed, threshold || 100);
                        };
                    }

                    accounts = fakeAccounts;

                    populatePage(accounts);

                    //initialize isotope
                    // quick search regex
                    let qsRegex;
                    let elements = document.querySelectorAll('.grid-item');
                    
                    // init Isotope
                    $container.isotope({
                        itemSelector: '.grid-item',
                        percentPosition: true,
                        filter: '.onLoad',
                        getSortData: {
                            name: '.name',
                            nameDesc: '.name',
                            age: '.age parseInt',
                            ageDesc: '.age parseInt',
                            face: '.face',
                            faceDesc: '.face',
                        },
                        sortAscending: {
                            name: true,
                            nameDesc: false,
                            age: true,
                            ageDesc: false,
                            face: true,
                            faceDesc: false,
                        }
                    });
                
                    //use value of input select to filter
                    let checkboxes = document.querySelectorAll('.ml--filtergroup input');
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', e => {
                            if(e.currentTarget.classList.contains('all')) {
                                e.currentTarget.checked = true;
                                e.currentTarget.parentElement.classList.add('is-checked');
                                e.currentTarget.parentElement.parentElement.querySelectorAll('input:not(.all)').forEach(input => {
                                    input.checked = false;
                                    input.parentElement.classList.remove('is-checked');
                                });
                            } else {
                                if(e.currentTarget.parentElement.classList.contains('is-checked')) {
                                    e.currentTarget.checked = false;
                                    e.currentTarget.parentElement.classList.remove('is-checked');
                                } else {
                                    e.currentTarget.checked = true;
                                    e.currentTarget.parentElement.classList.add('is-checked');
                                    e.currentTarget.parentElement.parentElement.querySelector('input.all').checked = false;
                                    e.currentTarget.parentElement.parentElement.querySelector('input.all').parentElement.classList.remove('is-checked');
                                }
                            }
                            let labels = e.currentTarget.parentElement.parentElement.querySelectorAll('label');
                            let checked = 0;
                            labels.forEach(label => {
                                if(label.classList.contains('is-checked')) {
                                    checked++;
                                }
                            });
                            if(checked === 0) {
                                e.currentTarget.parentElement.parentElement.querySelector('input.all').checked = true;
                                e.currentTarget.parentElement.parentElement.querySelector('input.all').parentElement.classList.add('is-checked');
                            }
                            //set filters
                            setCustomFilter();
                        });
                    });
                    
                    // use value of search field to filter
                    document.querySelector('#quicksearch').addEventListener('keyup', e => {
                        setCustomFilter();
                    });

                    // bind sort button click
                    let sortButtons = document.querySelectorAll('.ml--sort-inner button');
                    sortButtons.forEach(button => {
                        button.addEventListener('click', e => {
                            let sortValue = e.currentTarget.dataset.sort;
                            $container.isotope({ sortBy: sortValue });
                            sortButtons.forEach(button => {
                                button.classList.remove('is-checked');
                            });
                            e.currentTarget.classList.add('is-checked');
                        });
                    });
                    </script>
            </section>
        </main>

        <!-- Copyright Information -->
        <div class="tableborder" align="center">
            <div class="row4" style="font-size: 7.5pt; padding-top: 1px; padding-bottom: 1px; line-height: 8pt;">
                <div class="copyright" align="center">
                    Powered by 
                    <a href="https://www.invisionboard.com" target="_blank">Invision Power Board</a>
                    (<a href="http://jcink.com" target="_blank">Jcink.com </a>
                    <a href="https://jcink.com" target="_blank">Forum Hosting</a>
                    ) © 2020 &nbsp;
                    <a href="https://www.invisionpower.com" target="_blank">IPS, Inc.</a>
                    <br>
                    Page creation time: 0.0054 <!-- http://luxtradition.b1.jcink.com -->  · 
                    <a href="index.php?act=Mobile">Mobile Version</a> · 
                    <a href="index.php?act=privacy">Privacy Policy</a>
                </div>
            </div>
        </div> 

        <!--Templates-->
        <script type="text/javascript" src="../templates/navigation.js"></script>
        <script type="text/javascript" src="../templates/header.js"></script>
        <script type="text/javascript" src="../templates/memberControls.js"></script>
        <script type="text/javascript" src="../templates/guestControls.js"></script>

        <!--Scripts-->
        <script src="../js/functions.js"></script>
        <script src="../js/scripts.js"></script>
    </body>
</html>